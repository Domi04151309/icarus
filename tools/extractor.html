<h1>Data Extractor</h1>
<p id="result"></p>
<script>
  const COLUMN_CATEGORY_TITLE = 0
  const COLUMN_EXERCISE_TITLE = 1
  const COLUMN_VARIATION_TITLE = 2
  const COLUMN_FAT_LOSS = 3
  const COLUMN_MUSCLE_GAIN = 8
  const COLUMN_CARDIO = 9
  const COLUMN_ENDURANCE= 10
  const COLUMN_ARMS = 11
  const COLUMN_SHOULDERS = 12
  const COLUMN_BACK = 13
  const COLUMN_CHEST = 14
  const COLUMN_ABS = 15
  const COLUMN_BOOTY = 16
  const COLUMN_LEGS = 17
  const COLUMN_TUTORIAL = 34

  const FILE_PATH = './Data%20-%20Exercises.csv'
  const IGNORE_LINES = [1, 33, 44, 59]

  function getIntFromArray(array, index) {
    var temp = parseInt(array[index], 10)
    if (isNaN(temp)) return 0
    else return temp
  }

  fetch(FILE_PATH)
    .then(response => response.text())
    .then(result => {
      var lines = result.split('\n')

      var removedLines = 0
      IGNORE_LINES.forEach(item => {
        lines.splice(item - removedLines - 1 , 1)
        removedLines++
      })

      var data = []
      var lineArray = []
      var categoryObj = null
      var exerciseObj = null

      lines.forEach(item => {
        lineArray = CSVtoArray(item)
        if (lineArray == null) {
          console.error('Invalid Item: ' + item)
          return
        }
        if (lineArray[COLUMN_CATEGORY_TITLE] != '') {
          categoryObj = new Object()
          data.push(categoryObj)
          categoryObj.title = lineArray[COLUMN_CATEGORY_TITLE]
          categoryObj.exercises = []
        }
        if (lineArray[COLUMN_EXERCISE_TITLE] != '') {
          exerciseObj = new Object()
          categoryObj.exercises.push(exerciseObj)
          exerciseObj.title = lineArray[COLUMN_EXERCISE_TITLE]
          exerciseObj.variations = []
        }
        exerciseObj.variations.push({
          title: lineArray[COLUMN_VARIATION_TITLE],
          tutorial: lineArray[COLUMN_TUTORIAL],
          fatLoss: getIntFromArray(lineArray, COLUMN_FAT_LOSS),
          muscleGain: getIntFromArray(lineArray, COLUMN_MUSCLE_GAIN),
          cardio: getIntFromArray(lineArray, COLUMN_CARDIO),
          endurance: getIntFromArray(lineArray, COLUMN_ENDURANCE),
          arms: getIntFromArray(lineArray, COLUMN_ARMS),
          shoulders: getIntFromArray(lineArray, COLUMN_SHOULDERS),
          back: getIntFromArray(lineArray, COLUMN_BACK),
          chest: getIntFromArray(lineArray, COLUMN_CHEST),
          abs: getIntFromArray(lineArray, COLUMN_ABS),
          booty: getIntFromArray(lineArray, COLUMN_BOOTY),
          legs: getIntFromArray(lineArray, COLUMN_LEGS)
        })
      })
      console.log(data)
      document.getElementById('result').innerHTML = JSON.stringify(data)
    })

    function CSVtoArray(text) {
      var re_valid = /^\s*(?:'[^'\\]*(?:\\[\S\s][^'\\]*)*'|"[^"\\]*(?:\\[\S\s][^"\\]*)*"|[^,'"\s\\]*(?:\s+[^,'"\s\\]+)*)\s*(?:,\s*(?:'[^'\\]*(?:\\[\S\s][^'\\]*)*'|"[^"\\]*(?:\\[\S\s][^"\\]*)*"|[^,'"\s\\]*(?:\s+[^,'"\s\\]+)*)\s*)*$/;
      var re_value = /(?!\s*$)\s*(?:'([^'\\]*(?:\\[\S\s][^'\\]*)*)'|"([^"\\]*(?:\\[\S\s][^"\\]*)*)"|([^,'"\s\\]*(?:\s+[^,'"\s\\]+)*))\s*(?:,|$)/g;

      // Return NULL if input string is not well formed CSV string.
      if (!re_valid.test(text)) return null;

      var a = []; // Initialize array to receive values.
      text.replace(re_value, // "Walk" the string using replace with callback.
          function(m0, m1, m2, m3) {

              // Remove backslash from \' in single quoted values.
              if (m1 !== undefined) a.push(m1.replace(/\\'/g, "'"));

              // Remove backslash from \" in double quoted values.
              else if (m2 !== undefined) a.push(m2.replace(/\\"/g, '"'));
              else if (m3 !== undefined) a.push(m3);
              return ''; // Return empty string.
          });

      // Handle special case of empty last value.
      if (/,\s*$/.test(text)) a.push('');
      return a;
    }
</script>
